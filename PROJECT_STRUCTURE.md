# é¡¹ç›®ç»“æ„è¯´æ˜

```
lueying/                           # é¡¹ç›®æ ¹ç›®å½•
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json              # TypeScripté…ç½®
â”‚   â”œâ”€â”€ tailwind.config.ts         # Tailwind CSSé…ç½®
â”‚   â”œâ”€â”€ postcss.config.js          # PostCSSé…ç½®
â”‚   â”œâ”€â”€ next.config.js             # Next.jsé…ç½®
â”‚   â”œâ”€â”€ .eslintrc.json             # ESLinté…ç½®
â”‚   â”œâ”€â”€ .env.local                 # ç¯å¢ƒå˜é‡ï¼ˆç®¡ç†å‘˜å¯†ç ç­‰ï¼‰
â”‚   â””â”€â”€ .gitignore                 # Gitå¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                  # å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ QUICKSTART.md              # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â”‚   â””â”€â”€ prompt.md                  # åŸå§‹éœ€æ±‚æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ¨ app/                        # Next.js App Routerä¸»ç›®å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸŒ Guestç«¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page.tsx               # ä¸»é¡µï¼ˆæµ·æŠ¥+å¯¼èˆªï¼‰
â”‚   â”‚   â”œâ”€â”€ lottery/               # æŠ½å¥–ç»“æœé¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ danmaku/               # å¼¹å¹•å‘é€é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ programs/              # èŠ‚ç›®è¿›åº¦é¡µé¢
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ” Adminç«¯é¡µé¢
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ page.tsx           # ç™»å½•é¡µé¢
â”‚   â”‚       â”œâ”€â”€ dashboard/         # æ§åˆ¶å°
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”œâ”€â”€ programs/          # èŠ‚ç›®ç®¡ç†
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”œâ”€â”€ danmaku/           # å¼¹å¹•ç®¡ç†
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â””â”€â”€ lottery/           # æŠ½å¥–ç®¡ç†
â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ”Œ APIè·¯ç”±
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ admin/
â”‚   â”‚       â”‚   â””â”€â”€ login/         # ç®¡ç†å‘˜ç™»å½•API
â”‚   â”‚       â”‚       â””â”€â”€ route.ts
â”‚   â”‚       â”œâ”€â”€ programs/          # èŠ‚ç›®å•API
â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚       â”œâ”€â”€ danmaku/           # å¼¹å¹•API
â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚       â””â”€â”€ lottery/
â”‚   â”‚           â”œâ”€â”€ config/        # æŠ½å¥–é…ç½®API
â”‚   â”‚           â”‚   â””â”€â”€ route.ts
â”‚   â”‚           â””â”€â”€ result/        # æŠ½å¥–ç»“æœAPI
â”‚   â”‚               â””â”€â”€ route.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx                 # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ globals.css                # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ ğŸ”§ lib/                        # å·¥å…·åº“
â”‚   â”œâ”€â”€ auth.ts                    # è®¤è¯å·¥å…·ï¼ˆJWTã€å¯†ç éªŒè¯ï¼‰
â”‚   â””â”€â”€ dataStore.ts               # æ•°æ®å­˜å‚¨ï¼ˆå†…å­˜æ•°æ®åº“ï¼‰
â”‚
â””â”€â”€ ğŸ“¦ types/                      # TypeScriptç±»å‹å®šä¹‰
    â””â”€â”€ index.ts                   # å…¨å±€ç±»å‹å®šä¹‰
```

## æ–‡ä»¶åŠŸèƒ½è¯´æ˜

### æ ¸å¿ƒé¡µé¢

#### Guestç«¯ï¼ˆè§‚ä¼—ç«¯ï¼‰
- **ä¸»é¡µ** (`app/page.tsx`)
  - æ˜¾ç¤ºæ™šä¼šæµ·æŠ¥
  - ä¸‰ä¸ªåŠŸèƒ½å…¥å£ï¼šæŠ½å¥–ã€å¼¹å¹•ã€èŠ‚ç›®è¿›åº¦
  - å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯é€‚é…

- **æŠ½å¥–é¡µé¢** (`app/lottery/page.tsx`)
  - GET `/api/lottery/result` è·å–æŠ½å¥–ç»“æœ
  - æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
  - ç½‘æ ¼å±•ç¤ºä¸­å¥–å·ç 

- **å¼¹å¹•é¡µé¢** (`app/danmaku/page.tsx`)
  - POST `/api/danmaku` å‘é€å¼¹å¹•
  - å­—æ•°é™åˆ¶100å­—ç¬¦
  - å®æ—¶åé¦ˆå‘é€çŠ¶æ€

- **èŠ‚ç›®è¿›åº¦é¡µé¢** (`app/programs/page.tsx`)
  - GET `/api/programs` è·å–èŠ‚ç›®å•
  - è¿›åº¦æ¡æ˜¾ç¤ºæ•´ä½“è¿›åº¦
  - Todo-listæ ·å¼å±•ç¤ºèŠ‚ç›®

#### Adminç«¯ï¼ˆç®¡ç†å‘˜ç«¯ï¼‰
- **ç™»å½•é¡µ** (`app/admin/page.tsx`)
  - å¯†ç è®¤è¯
  - JWT Tokenç”Ÿæˆ
  - localStorageå­˜å‚¨Token

- **æ§åˆ¶å°** (`app/admin/dashboard/page.tsx`)
  - æƒé™éªŒè¯
  - å››å¤§åŠŸèƒ½æ¨¡å—å…¥å£
  - é€€å‡ºç™»å½•

- **èŠ‚ç›®ç®¡ç†** (`app/admin/programs/page.tsx`)
  - æŸ¥çœ‹æ‰€æœ‰èŠ‚ç›®
  - ç‚¹å‡»å‹¾é€‰å®ŒæˆèŠ‚ç›®
  - PATCH `/api/programs` æ›´æ–°çŠ¶æ€
  - å®æ—¶è¿›åº¦ç»Ÿè®¡

- **å¼¹å¹•ç®¡ç†** (`app/admin/danmaku/page.tsx`)
  - GET `/api/danmaku` è·å–å¼¹å¹•åˆ—è¡¨
  - æ¯3ç§’è‡ªåŠ¨åˆ·æ–°
  - ä¸€é”®å¤åˆ¶åŠŸèƒ½
  - DELETE `/api/danmaku` æ¸…ç©ºæ‰€æœ‰å¼¹å¹•

- **æŠ½å¥–ç®¡ç†** (`app/admin/lottery/page.tsx`)
  - é…ç½®æŠ½å¥–å‚æ•°ï¼ˆèŒƒå›´ã€æ•°é‡ï¼‰
  - æ»šåŠ¨æ•°å­—æŠ½å¥–åŠ¨ç”»
  - POST `/api/lottery/result` å‘å¸ƒç»“æœ
  - ç»“æœè‡ªåŠ¨åŒæ­¥åˆ°Guestç«¯

### APIæ¥å£

#### å…¬å¼€APIï¼ˆæ— éœ€è®¤è¯ï¼‰
- `GET /api/programs` - è·å–èŠ‚ç›®å•
- `GET /api/lottery/result` - è·å–æŠ½å¥–ç»“æœ
- `POST /api/danmaku` - å‘é€å¼¹å¹•

#### ç®¡ç†å‘˜APIï¼ˆéœ€è¦Tokenè®¤è¯ï¼‰
- `POST /api/admin/login` - ç®¡ç†å‘˜ç™»å½•
- `POST /api/programs` - æ›´æ–°æ•´ä¸ªèŠ‚ç›®å•
- `PATCH /api/programs` - æ›´æ–°å•ä¸ªèŠ‚ç›®çŠ¶æ€
- `GET /api/danmaku` - è·å–å¼¹å¹•åˆ—è¡¨
- `DELETE /api/danmaku` - æ¸…ç©ºå¼¹å¹•
- `GET /api/lottery/config` - è·å–æŠ½å¥–é…ç½®
- `POST /api/lottery/config` - æ›´æ–°æŠ½å¥–é…ç½®
- `POST /api/lottery/result` - å‘å¸ƒæŠ½å¥–ç»“æœ

### å·¥å…·åº“

#### auth.ts - è®¤è¯å·¥å…·
- `hashPassword()` - å¯†ç å“ˆå¸Œ
- `verifyPassword()` - å¯†ç éªŒè¯
- `generateToken()` - ç”ŸæˆJWT
- `verifyToken()` - éªŒè¯JWT
- `getTokenFromRequest()` - ä»è¯·æ±‚ä¸­æå–Token

#### dataStore.ts - æ•°æ®å­˜å‚¨
- èŠ‚ç›®å•ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- å¼¹å¹•ç®¡ç†ï¼ˆæ·»åŠ ã€è·å–ã€æ¸…ç©ºï¼‰
- æŠ½å¥–é…ç½®ç®¡ç†
- æŠ½å¥–ç»“æœç®¡ç†

### ç±»å‹å®šä¹‰

#### types/index.ts
- `Program` - èŠ‚ç›®æ•°æ®ç»“æ„
- `Danmaku` - å¼¹å¹•æ•°æ®ç»“æ„
- `LotteryConfig` - æŠ½å¥–é…ç½®ç»“æ„
- `LotteryResult` - æŠ½å¥–ç»“æœç»“æ„

## æ•°æ®æµ

### Guestç«¯æ•°æ®æµ
```
ç”¨æˆ·è®¿é—® â†’ Guesté¡µé¢ â†’ APIè°ƒç”¨ â†’ æ•°æ®å­˜å‚¨ â†’ è¿”å›æ•°æ® â†’ é¡µé¢å±•ç¤º
```

### Adminç«¯æ•°æ®æµ
```
ç®¡ç†å‘˜ç™»å½• â†’ è·å–Token â†’ æºå¸¦Tokenè¯·æ±‚API â†’ éªŒè¯æƒé™ â†’ æ“ä½œæ•°æ® â†’ è¿”å›ç»“æœ
```

### æŠ½å¥–æµç¨‹
```
Adminé…ç½®å‚æ•° â†’ å¼€å§‹æŠ½å¥– â†’ æ»šåŠ¨åŠ¨ç”» â†’ ç”Ÿæˆç»“æœ â†’ POST API â†’ æ•°æ®å­˜å‚¨
                                                          â†“
GuestæŸ¥è¯¢ç»“æœ â† GET API â† å®šæ—¶åˆ·æ–° â† ç­‰å¾…ç»“æœ â† é¡µé¢åŠ è½½
```

### å¼¹å¹•æµç¨‹
```
Guestå‘é€ â†’ POST API â†’ æ•°æ®å­˜å‚¨
                          â†“
AdminæŸ¥çœ‹ â† GET API â† å®šæ—¶åˆ·æ–°
```

## é¡µé¢è·¯ç”±

```
/                          # Guestä¸»é¡µ
â”œâ”€â”€ /lottery              # æŠ½å¥–ç»“æœ
â”œâ”€â”€ /danmaku              # å¼¹å¹•å‘é€
â””â”€â”€ /programs             # èŠ‚ç›®è¿›åº¦

/admin                     # Adminç™»å½•
â””â”€â”€ /admin/dashboard      # æ§åˆ¶å°
    â”œâ”€â”€ /admin/programs   # èŠ‚ç›®ç®¡ç†
    â”œâ”€â”€ /admin/danmaku    # å¼¹å¹•ç®¡ç†
    â””â”€â”€ /admin/lottery    # æŠ½å¥–ç®¡ç†
```

## æŠ€æœ¯ç‰¹ç‚¹

1. **Next.js 14 App Router** - æœ€æ–°è·¯ç”±ç³»ç»Ÿ
2. **TypeScript** - ç±»å‹å®‰å…¨
3. **Tailwind CSS** - å¿«é€Ÿæ ·å¼å¼€å‘
4. **JWTè®¤è¯** - å®‰å…¨çš„æƒé™ç®¡ç†
5. **å“åº”å¼è®¾è®¡** - å®Œç¾ç§»åŠ¨ç«¯æ”¯æŒ
6. **å®æ—¶åˆ·æ–°** - è‡ªåŠ¨æ›´æ–°æ•°æ®
7. **ä¼˜é›…åŠ¨ç”»** - TailwindåŠ¨ç”»æ•ˆæœ
