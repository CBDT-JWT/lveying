# 弹幕审核和大屏显示功能说明

## 🎬 新功能概述

系统现在支持弹幕审核功能和大屏显示，管理员可以审核弹幕内容，审核通过的弹幕会在专门的大屏页面上显示。

## ✨ 功能特性

### 1. 弹幕审核系统
- ✅ 弹幕发送后默认为待审核状态（censor: false）
- ✅ Admin 可以点击"审核通过"将弹幕标记为已审核（censor: true）
- ✅ 可以取消审核，将弹幕改回待审核状态
- ✅ 统计显示：弹幕总数、已审核、待审核

### 2. 弹幕大屏显示
- ✅ 黑底白字，简洁大气
- ✅ 竖版排列，最多显示 15 行
- ✅ 新弹幕从左下角进入（从左向右滑入动画）
- ✅ 旧弹幕自动向上移动
- ✅ 只显示已审核通过的弹幕
- ✅ 每 2 秒自动更新

### 3. 数据结构
```typescript
interface Danmaku {
  id: string;
  content: string;
  timestamp: number;
  censor: boolean; // 审核状态
}
```

## 📋 使用指南

### Admin 端操作

#### 1. 访问弹幕管理
```
http://localhost:3000/admin/dashboard
```
点击"💬 弹幕管理"进入弹幕管理页面

#### 2. 查看弹幕统计
页面顶部显示三个统计卡片：
- **弹幕总数**：所有弹幕的数量
- **已审核**：审核通过的弹幕数量（绿色）
- **待审核**：未审核的弹幕数量（橙色）

#### 3. 审核弹幕
每条弹幕都有状态标签和操作按钮：

**待审核弹幕（橙色背景）**：
- 状态标签：⏳ 待审核
- 操作按钮：
  - **✓ 审核通过**（绿色按钮）- 点击后弹幕变为已审核状态
  - **复制**（蓝色按钮）- 复制弹幕内容

**已审核弹幕（绿色背景）**：
- 状态标签：✓ 已审核
- 操作按钮：
  - **取消审核**（橙色按钮）- 点击后弹幕变回待审核状态
  - **复制**（蓝色按钮）- 复制弹幕内容

#### 4. 打开弹幕大屏
从 Admin Dashboard 点击"📺 弹幕大屏"，会在新标签页打开显示页面

### 弹幕大屏显示

#### 访问地址
```
http://localhost:3000/display
```

#### 显示效果
```
┌─────────────────────────────────────┐
│                                     │ ← 空白区域
│                                     │
│                                     │
│                                     │
│                                     │
│                                     │
│                                     │
│ 欢迎大家来到晚会现场！               │ ← 第 1 条弹幕
│ 节目太精彩了                         │ ← 第 2 条弹幕
│ 主持人好帅                           │ ← 第 3 条弹幕
│ ...                                 │
│ ...                                 │
│ 刚刚发送的最新弹幕                   │ ← 第 15 条（最新）
└─────────────────────────────────────┘
  ↑
  新弹幕从这里滑入
```

#### 显示特点
1. **黑色背景**，纯黑（#000000）
2. **白色文字**，纯白（#FFFFFF）
3. **大号字体**：text-4xl（约 36px）
4. **左对齐**：所有弹幕从左边开始
5. **底部对齐**：弹幕从屏幕底部向上排列
6. **最多 15 行**：超过 15 条时，最旧的弹幕会被移除
7. **滑入动画**：新弹幕从左边滑入（0.5 秒动画）

### Guest 端操作

#### 发送弹幕
1. 访问 `http://localhost:3000/danmaku`
2. 输入弹幕内容（最多 100 字符）
3. 点击"发送"按钮
4. 弹幕发送后默认为**待审核**状态
5. 管理员审核通过后，弹幕会出现在大屏上

## 🎯 工作流程

### 完整流程图
```
Guest 发送弹幕
    ↓
保存到数据库（censor: false）
    ↓
Admin 在弹幕管理页面看到
    ↓
Admin 点击"✓ 审核通过"
    ↓
弹幕状态变为 censor: true
    ↓
弹幕出现在大屏显示页面
    ↓
每 2 秒自动刷新检查新弹幕
```

### 数据流转
```
┌──────────────┐
│ Guest 发送   │
│ /danmaku     │
└──────┬───────┘
       ↓
┌──────────────────────┐
│ POST /api/danmaku    │
│ 创建弹幕             │
│ censor: false        │
└──────┬───────────────┘
       ↓
┌──────────────────────┐
│ data/store.json      │
│ 持久化存储           │
└──────┬───────────────┘
       ↓
┌──────────────────────┐
│ Admin 审核           │
│ PATCH /api/danmaku   │
│ censor: true         │
└──────┬───────────────┘
       ↓
┌──────────────────────┐
│ GET /api/danmaku/    │
│     censored         │
│ 获取已审核弹幕       │
└──────┬───────────────┘
       ↓
┌──────────────────────┐
│ /display 页面        │
│ 大屏显示             │
└──────────────────────┘
```

## 🔧 API 接口

### 1. 获取所有弹幕（Admin）
```http
GET /api/danmaku
Headers: Authorization: Bearer {token}

Response: {
  "danmakus": [
    {
      "id": "1763976009926",
      "content": "测试弹幕",
      "timestamp": 1763976009926,
      "censor": false
    }
  ]
}
```

### 2. 发送弹幕（Guest）
```http
POST /api/danmaku
Content-Type: application/json

Body: {
  "content": "这是一条弹幕"
}

Response: {
  "success": true,
  "danmaku": {
    "id": "...",
    "content": "这是一条弹幕",
    "timestamp": 1763976009926,
    "censor": false
  }
}
```

### 3. 更新审核状态（Admin）
```http
PATCH /api/danmaku
Headers: Authorization: Bearer {token}
Content-Type: application/json

Body: {
  "id": "1763976009926",
  "censor": true
}

Response: {
  "success": true
}
```

### 4. 获取已审核弹幕（公开）
```http
GET /api/danmaku/censored

Response: {
  "danmakus": [
    {
      "id": "1763976009926",
      "content": "已审核的弹幕",
      "timestamp": 1763976009926,
      "censor": true
    }
  ]
}
```

## 💡 使用场景

### 场景 1：晚会现场弹幕展示
1. 在大屏幕上打开 `/display` 页面（全屏模式）
2. 观众通过手机发送弹幕
3. 管理员实时审核弹幕内容
4. 审核通过的弹幕立即显示在大屏上
5. 营造互动氛围

### 场景 2：内容过滤
1. 避免不当内容直接显示
2. 管理员可以筛选优质弹幕
3. 控制弹幕质量和数量
4. 保证现场展示效果

### 场景 3：精选弹幕
1. 从大量弹幕中挑选有趣的内容
2. 只展示最精彩的评论
3. 提升观众参与感
4. 活跃现场气氛

## 🎨 显示优化建议

### 大屏展示最佳实践

#### 1. 屏幕设置
- 使用全屏模式（按 F11）
- 推荐分辨率：1920x1080 或更高
- 黑色背景最适合大屏幕投影

#### 2. 字体大小
当前默认：text-4xl（约 36px）
- 如需调整，可修改 `app/display/page.tsx` 中的 `text-4xl`
- 小场地：text-3xl（约 30px）
- 大场地：text-5xl（约 48px）
- 超大场地：text-6xl（约 60px）

#### 3. 显示行数
当前默认：15 行
- 如需调整，修改 `MAX_LINES` 常量
- 建议范围：10-20 行
- 太少：更新不够频繁
- 太多：字体会显得拥挤

#### 4. 刷新频率
当前默认：每 2 秒
- 如需调整，修改 `setInterval` 参数
- 快速互动：1 秒
- 正常场景：2 秒
- 慢速展示：5 秒

### 动画效果调整

在 `app/display/page.tsx` 中可以调整：

```jsx
// 滑入速度（当前 0.5 秒）
animation: slideIn 0.5s ease-out forwards;

// 可以改为：
animation: slideIn 0.3s ease-out forwards; // 更快
animation: slideIn 1s ease-out forwards;   // 更慢
```

## 📊 数据管理

### 查看审核统计
在 Admin 弹幕管理页面顶部：
```
┌─────────────┬─────────────┬─────────────┐
│ 弹幕总数    │ 已审核      │ 待审核      │
│    50       │    30       │    20       │
└─────────────┴─────────────┴─────────────┘
```

### 批量操作
- **清空弹幕**：点击"清空弹幕"按钮删除所有弹幕
- **注意**：此操作不可恢复，谨慎使用

### 数据持久化
所有弹幕数据保存在 `data/store.json` 文件中：
```json
{
  "danmakus": [
    {
      "id": "1763976009926",
      "content": "精彩的表演",
      "timestamp": 1763976009926,
      "censor": true
    }
  ]
}
```

## ⚠️ 注意事项

### 1. 审核及时性
- 弹幕发送后不会立即显示在大屏
- 需要管理员手动审核通过
- 建议安排专人负责审核工作
- 审核速度影响互动体验

### 2. 内容管理
- 仔细审核弹幕内容
- 过滤不当言论
- 保持现场秩序
- 避免敏感话题

### 3. 性能考虑
- 大量弹幕时，定期清理旧数据
- 显示页面自动限制为 15 行
- API 自动按时间排序
- 建议晚会结束后清空弹幕

### 4. 网络稳定性
- 确保服务器网络稳定
- 观众需要连接到同一网络
- 大屏显示设备保持网络畅通
- 建议使用有线网络连接大屏

## 🚀 快速开始

### 第一次使用

1. **启动服务器**
   ```bash
   npm run dev
   ```

2. **打开大屏显示（投影到大屏幕）**
   ```
   http://localhost:3000/display
   ```
   按 F11 进入全屏模式

3. **打开 Admin 弹幕管理（管理员操作）**
   ```
   http://localhost:3000/admin/danmaku
   ```

4. **Guest 发送弹幕（观众操作）**
   ```
   http://localhost:3000/danmaku
   ```

5. **审核流程**
   - Guest 发送弹幕
   - Admin 在管理页面看到新弹幕（橙色背景）
   - Admin 点击"✓ 审核通过"
   - 弹幕变为绿色背景
   - 大屏上自动显示（2 秒内）

### 测试流程

1. 打开三个浏览器标签页
2. 标签 1：`/display`（大屏显示）
3. 标签 2：`/admin/danmaku`（管理员）
4. 标签 3：`/danmaku`（Guest）
5. 在标签 3 发送弹幕
6. 在标签 2 审核通过
7. 在标签 1 看到弹幕显示

---

**提示**：这个功能为晚会增添了实时互动体验，让观众参与感更强！🎉
